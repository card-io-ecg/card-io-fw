<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Card/IO configuration</title>
    <style type="text/css">
        body {
            font-family: 'Segoe UI';
            background-color: #ddd;
            font-size: 14px;
            padding: 1em;
        }

        #frame {
            margin: 0 auto;
            max-width: 800px;
            padding: 1em;
        }

        #header h1,
        #logo {
            display: inline-block;
            vertical-align: middle;
        }

        #header h1 {
            margin: 0;
            padding: 0;
            font: 3em 'Segoe UI';
            font-weight: normal;
            color: #333;
        }

        #logo {
            fill: #333;
            stroke: #333;
            font-family: 'Segoe UI';
            float: right;
            cursor: pointer;
        }

        #content {
            margin-top: 1em;
            padding: 1em;
            background-color: #eee;
            border-radius: 1em;
        }

        .center {
            text-align: center;
        }

        .tpl {
            display: none;
        }
    </style>
</head>

<body>
    <div id="frame">
        <div id="header-container">
            <span id="header"></span>
            <svg id="logo" viewBox="80 60 150 90" width="120" height="60">
                <text style="font-size: 44px;" x="77.386" y="107" dx="0 0 0 0 9.302">Card
                    IO</text>
                <path style="fill-opacity: 0; stroke-linecap: round; stroke-linejoin: round; stroke-width: 3px;"
                    d="M 80.55 113.063 L 170.418 112.824 L 178.571 74.279 L 187.51 138.286 L 192.926 112.422 L 228.61 112.497">
                </path>
                <text style="font-size: 20px;" x="110" y="137">2023</text>
            </svg>
        </div>

        <div id="content"></div>
    </div>

    <div id="demo" class="tpl">
        <h1 class="header">Welcome!</h1>
        <div class="content">
            <span class="data"></span><br />
            Firmware version: <span class="fw"></span>
        </div>
    </div>

    <div id="spinner" class="content center tpl">
        Loading...
    </div>
</body>

<script>
    $id = (id) => document.getElementById(id);
    $tpl = (id) => {
        let tpl = $id(id).cloneNode(true);
        tpl.style.display = "block";

        let content = tpl.querySelector(".content");
        if (content) {
            content.set = (name, value) => {
                let elem = tpl.querySelector("." + name);
                elem.innerHTML = value;
            }
        }

        return tpl;
    }
    $clear = (name) => {
        let elem = $id(name);
        while (elem.firstChild) {
            elem.removeChild(elem.lastChild);
        }
    }
    $on = (name, event, callback) => {
        $id(name).addEventListener(event, callback);
    }
    $show = (section, node) => {
        $clear(section);
        $id(section).appendChild(node);
    }
    $load = async (tpl_name, fn) => {
        let loaded = false;

        let tpl = $tpl(tpl_name);

        $show("header", tpl.querySelector(".header"));

        // Prevent rapid flashing
        let delay;
        new Promise((resolve) => setTimeout(resolve, 100)).then(() => {
            if (!loaded) {
                delay = new Promise((resolve) => setTimeout(resolve, 500));
                $show("content", $tpl("spinner"));
            }
        });

        let node = tpl.querySelector(".content");
        await fn(node);
        loaded = true;

        if (delay) {
            await delay;
        }

        $show("content", node);
    }

    $fe = {
        start: () => $load('demo', async (tpl) => {
            let demo = await fetch('/demo');
            let si = await fetch('/si');

            tpl.set("data", await demo.text());
            tpl.set("fw", await si.text());
        })
    };

    $on("logo", "click", $fe.start);
    document.addEventListener("DOMContentLoaded", $fe.start);
</script>

</html>